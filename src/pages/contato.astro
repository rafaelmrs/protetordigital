---
import Layout from '../layouts/Layout.astro';
---
<Layout
  title="Contato ‚Äî Fale com o ProtetorDigital"
  description="Entre em contato com o ProtetorDigital. Envie d√∫vidas, sugest√µes, reporte bugs ou fale sobre parcerias. Respondemos todos os e-mails."
  url="https://protetordigital.com/contato"
  schema={{
    "@context": "https://schema.org",
    "@type": "ContactPage",
    "name": "Contato ‚Äî ProtetorDigital",
    "url": "https://protetordigital.com/contato"
  }}
>
  <div class="container" style="padding-top:56px;padding-bottom:96px;max-width:720px;">

    <!-- Breadcrumb -->
    <nav aria-label="Localiza√ß√£o na p√°gina" style="margin-bottom:32px;">
      <ol class="breadcrumb">
        <li><a href="/">in√≠cio</a></li>
        <li class="breadcrumb-sep" aria-hidden="true">/</li>
        <li style="color:var(--text-2);">contato</li>
      </ol>
    </nav>

    <!-- Header -->
    <header style="margin-bottom:48px;">
      <h1 style="font-family:var(--font-body);font-size:clamp(1.8rem,4vw,2.6rem);font-weight:800;color:var(--text);letter-spacing:-0.04em;line-height:1.1;margin-bottom:16px;">
        Fale com a gente
      </h1>
      <p style="font-size:16px;color:var(--text-2);line-height:1.7;max-width:520px;">
        D√∫vidas, sugest√µes, reporte de bugs ou proposta de parceria ‚Äî respondemos todos os contatos, geralmente em at√© 48 horas.
      </p>
    </header>

    <!-- Contact reasons -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-bottom:48px;">
      {[
        { emoji: 'üêõ', label: 'Reportar bug', desc: 'Encontrou algo quebrado?' },
        { emoji: 'üí°', label: 'Sugest√£o', desc: 'Ideia para melhorar o site?' },
        { emoji: 'ü§ù', label: 'Parceria', desc: 'Quer colaborar conosco?' },
        { emoji: '‚ùì', label: 'D√∫vida', desc: 'Tem alguma pergunta?' },
      ].map(item => (
        <div class="card" style="padding:18px;display:flex;flex-direction:column;gap:6px;">
          <span style="font-size:22px;">{item.emoji}</span>
          <p style="font-size:13px;font-weight:700;color:var(--text);">{item.label}</p>
          <p style="font-size:12px;color:var(--text-3);">{item.desc}</p>
        </div>
      ))}
    </div>

    <!-- Contact Form -->
    <div class="card" style="padding:36px;" id="contact-card">
      <h2 style="font-family:var(--font-body);font-size:1.05rem;font-weight:700;color:var(--text);margin-bottom:28px;letter-spacing:-0.02em;">
        Enviar mensagem
      </h2>

      <!-- Success message (hidden by default) -->
      <div id="form-success" style="display:none;text-align:center;padding:32px 0;">
        <div style="font-size:40px;margin-bottom:16px;">‚úÖ</div>
        <h3 style="font-family:var(--font-body);font-size:1.1rem;font-weight:700;color:var(--text);margin-bottom:8px;">Mensagem enviada!</h3>
        <p style="font-size:14px;color:var(--text-2);">Obrigado pelo contato. Respondemos em at√© 48 horas.</p>
      </div>

      <!-- Error message (hidden by default) -->
      <div id="form-error" style="display:none;padding:14px 16px;background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.2);border-radius:var(--radius-md);margin-bottom:20px;font-size:13px;color:#fca5a5;">
        Ocorreu um erro ao enviar. Tente novamente ou mande um e-mail para <a href="mailto:contato@protetordigital.com" style="color:var(--blue);">contato@protetordigital.com</a>.
      </div>

      <div id="contact-form-wrapper">
        <div style="display:grid;gap:18px;">
          <!-- Nome -->
          <div>
            <label for="field-nome" style="display:block;font-size:13px;font-weight:600;color:var(--text);margin-bottom:7px;">Nome <span style="color:var(--red);" aria-hidden="true">*</span></label>
            <input
              id="field-nome"
              type="text"
              class="input"
              placeholder="Seu nome completo"
              autocomplete="name"
              required
              maxlength="100"
            />
          </div>

          <!-- E-mail -->
          <div>
            <label for="field-email" style="display:block;font-size:13px;font-weight:600;color:var(--text);margin-bottom:7px;">E-mail <span style="color:var(--red);" aria-hidden="true">*</span></label>
            <input
              id="field-email"
              type="email"
              class="input"
              placeholder="seu@email.com"
              autocomplete="email"
              required
            />
          </div>

          <!-- Assunto -->
          <div>
            <label for="field-assunto" style="display:block;font-size:13px;font-weight:600;color:var(--text);margin-bottom:7px;">Assunto <span style="color:var(--red);" aria-hidden="true">*</span></label>
            <select id="field-assunto" class="input" required style="cursor:pointer;">
              <option value="" disabled selected>Selecione o motivo do contato</option>
              <option value="bug">Reportar bug</option>
              <option value="sugestao">Sugest√£o de melhoria</option>
              <option value="parceria">Parceria</option>
              <option value="privacidade">Quest√£o sobre privacidade / LGPD</option>
              <option value="outro">Outro</option>
            </select>
          </div>

          <!-- Mensagem -->
          <div>
            <label for="field-mensagem" style="display:block;font-size:13px;font-weight:600;color:var(--text);margin-bottom:7px;">Mensagem <span style="color:var(--red);" aria-hidden="true">*</span></label>
            <textarea
              id="field-mensagem"
              class="input"
              rows="5"
              placeholder="Descreva em detalhes como podemos ajudar..."
              required
              maxlength="2000"
              style="resize:vertical;min-height:120px;"
            ></textarea>
            <p id="char-count" style="font-family:var(--font-mono);font-size:11px;color:var(--text-3);margin-top:5px;text-align:right;">0 / 2000</p>
          </div>

          <!-- Honeypot (anti-spam, oculto) -->
          <div style="display:none;" aria-hidden="true">
            <input id="field-hp" type="text" name="website" tabindex="-1" autocomplete="off" />
          </div>

          <!-- Submit -->
          <button id="btn-submit" type="button" class="btn btn-primary btn-full" style="margin-top:4px;">
            Enviar mensagem
          </button>

          <p style="font-size:12px;color:var(--text-3);text-align:center;line-height:1.6;">
            Ao enviar, voc√™ concorda com nossa <a href="/politica-privacidade" style="color:var(--blue);text-decoration:none;">Pol√≠tica de Privacidade</a>.<br/>
            Seu e-mail √© usado exclusivamente para responder sua mensagem.
          </p>
        </div>
      </div>
    </div>

    <!-- Direct email fallback -->
    <div style="margin-top:24px;padding:18px 22px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-md);display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
      <div style="width:36px;height:36px;background:rgba(59,130,246,0.1);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;flex-shrink:0;">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--blue)" stroke-width="2" stroke-linecap="round" aria-hidden="true">
          <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
          <polyline points="22,6 12,13 2,6"/>
        </svg>
      </div>
      <div>
        <p style="font-size:13px;font-weight:600;color:var(--text);margin-bottom:2px;">Prefere e-mail direto?</p>
        <a href="mailto:contato@protetordigital.com" style="font-family:var(--font-mono);font-size:13px;color:var(--blue);text-decoration:none;">contato@protetordigital.com</a>
      </div>
    </div>

  </div>

  <script>
    // Char counter
    const textarea = document.getElementById('field-mensagem') as HTMLTextAreaElement;
    const charCount = document.getElementById('char-count');
    textarea?.addEventListener('input', () => {
      if (charCount) charCount.textContent = `${textarea.value.length} / 2000`;
    });

    // Submit handler
    document.getElementById('btn-submit')?.addEventListener('click', async () => {
      const nome = (document.getElementById('field-nome') as HTMLInputElement)?.value.trim();
      const email = (document.getElementById('field-email') as HTMLInputElement)?.value.trim();
      const assunto = (document.getElementById('field-assunto') as HTMLSelectElement)?.value;
      const mensagem = (document.getElementById('field-mensagem') as HTMLTextAreaElement)?.value.trim();
      const hp = (document.getElementById('field-hp') as HTMLInputElement)?.value;
      const btn = document.getElementById('btn-submit') as HTMLButtonElement;
      const errEl = document.getElementById('form-error');
      const successEl = document.getElementById('form-success');
      const wrapper = document.getElementById('contact-form-wrapper');

      // Honeypot check
      if (hp) return;

      // Validate
      if (!nome || !email || !assunto || !mensagem) {
        if (errEl) { errEl.textContent = 'Preencha todos os campos obrigat√≥rios.'; errEl.style.display = 'block'; }
        return;
      }
      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        if (errEl) { errEl.textContent = 'Informe um e-mail v√°lido.'; errEl.style.display = 'block'; }
        return;
      }

      // Loading state
      btn.disabled = true;
      btn.textContent = 'Enviando‚Ä¶';
      if (errEl) errEl.style.display = 'none';

      try {
        // Envia para Formspree ‚Äî substitua o endpoint abaixo pelo seu
        // Crie gr√°tis em https://formspree.io
        const FORMSPREE_ENDPOINT = import.meta.env.PUBLIC_FORMSPREE_ENDPOINT || 'https://formspree.io/f/SEU_ID_AQUI';

        const res = await fetch(FORMSPREE_ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
          body: JSON.stringify({ nome, email, assunto, mensagem }),
        });

        if (res.ok) {
          if (wrapper) wrapper.style.display = 'none';
          if (successEl) successEl.style.display = 'block';
        } else {
          throw new Error('Erro na requisi√ß√£o');
        }
      } catch {
        if (errEl) { errEl.textContent = 'Falha ao enviar. Tente mais tarde ou use o e-mail direto.'; errEl.style.display = 'block'; }
        btn.disabled = false;
        btn.textContent = 'Enviar mensagem';
      }
    });
  </script>
</Layout>
