---
import Layout from '../../layouts/Layout.astro';
import AdSense from '../../components/AdSense.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

const allPosts = await getCollection('blog');
const related = allPosts
  .filter(p => p.slug !== post.slug && p.data.tags.some(t => post.data.tags.includes(t)))
  .slice(0, 2);
---

<Layout
  title={post.data.title}
  description={post.data.description}
  url={`https://segurancaonline.com.br/blog/${post.slug}`}
>
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": post.data.title,
    "description": post.data.description,
    "author": { "@type": "Organization", "name": post.data.author },
    "datePublished": post.data.pubDate.toISOString(),
    "dateModified": (post.data.updatedDate || post.data.pubDate).toISOString(),
    "publisher": {
      "@type": "Organization",
      "name": "SeguranÃ§aOnline.com.br",
      "url": "https://segurancaonline.com.br"
    },
    "url": `https://segurancaonline.com.br/blog/${post.slug}`,
    "inLanguage": "pt-BR"
  })} />

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <nav class="text-sm text-gray-500 dark:text-gray-400 mb-6" aria-label="breadcrumb">
      <ol class="flex items-center gap-2">
        <li><a href="/" class="hover:text-primary-600 dark:hover:text-primary-400">Home</a></li>
        <li>â€º</li>
        <li><a href="/blog" class="hover:text-primary-600 dark:hover:text-primary-400">Blog</a></li>
        <li>â€º</li>
        <li class="text-gray-800 dark:text-gray-200 truncate max-w-xs">{post.data.title}</li>
      </ol>
    </nav>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <article class="lg:col-span-2">
        <!-- Header -->
        <header class="mb-8">
          <div class="flex flex-wrap gap-2 mb-4">
            {post.data.tags.map(tag => (
              <span class="text-xs bg-primary-50 dark:bg-primary-950 text-primary-600 dark:text-primary-400 px-2 py-0.5 rounded-full">
                #{tag}
              </span>
            ))}
          </div>
          <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4 leading-tight">
            {post.data.title}
          </h1>
          <p class="text-lg text-gray-600 dark:text-gray-400 mb-4">{post.data.description}</p>
          <div class="flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-700 pt-4">
            <span>âœï¸ {post.data.author}</span>
            <span>Â·</span>
            <time datetime={post.data.pubDate.toISOString()}>
              {post.data.pubDate.toLocaleDateString('pt-BR', { day: '2-digit', month: 'long', year: 'numeric' })}
            </time>
          </div>
        </header>

        <!-- Content -->
        <div class="prose prose-lg dark:prose-invert max-w-none prose-headings:font-bold prose-a:text-primary-600 dark:prose-a:text-primary-400 prose-code:bg-gray-100 dark:prose-code:bg-gray-800 prose-code:rounded prose-code:px-1">
          <Content />
        </div>

        <AdSense slot="BETWEEN_RESULTS_SLOT_ID" width={336} height={280} className="my-8" />

        <!-- Related posts -->
        {related.length > 0 && (
          <div class="mt-12">
            <h2 class="text-2xl font-bold mb-6">ğŸ“š Posts Relacionados</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              {related.map(r => (
                <a href={`/blog/${r.slug}`} class="bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 hover:border-primary-300 dark:hover:border-primary-700 transition-all hover:-translate-y-0.5">
                  <h3 class="font-bold text-sm text-gray-900 dark:text-white mb-1 hover:text-primary-600 dark:hover:text-primary-400">{r.data.title}</h3>
                  <p class="text-xs text-gray-500">{r.data.description}</p>
                </a>
              ))}
            </div>
          </div>
        )}
      </article>

      <aside class="space-y-6">
        <AdSense slot="SIDEBAR_SLOT_ID" width={300} height={600} />

        <!-- Tools CTA -->
        <div class="bg-gradient-to-br from-primary-600 to-indigo-700 rounded-2xl p-5 text-white sticky top-20">
          <h3 class="font-bold mb-2">ğŸ›¡ï¸ Ferramentas Gratuitas</h3>
          <p class="text-blue-100 text-sm mb-4">Proteja-se com nossas ferramentas de seguranÃ§a.</p>
          <div class="space-y-2">
            <a href="/tools/senha" class="block text-center py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-medium transition-colors">
              ğŸ” Analisar Senha
            </a>
            <a href="/tools/link" class="block text-center py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-medium transition-colors">
              ğŸ”— Scanner de URL
            </a>
            <a href="/tools/vazamento" class="block text-center py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-medium transition-colors">
              ğŸ“§ Verificar Email
            </a>
          </div>
        </div>
      </aside>
    </div>
  </div>
</Layout>
