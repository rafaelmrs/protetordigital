---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const allTags = [...new Set(posts.flatMap(p => p.data.tags))];
const featured = posts.find(p => p.data.featured);
const rest = posts.filter(p => !p.data.featured || p !== featured);

const ADSENSE_ID = import.meta.env.PUBLIC_ADSENSE_ID;
---

<Layout
  title="Blog de Segurança Digital — Dicas Práticas para se Proteger Online"
  description="Artigos simples e práticos sobre como proteger seus dados, evitar golpes e usar a internet com mais segurança. Novos artigos toda semana."
  url="https://protetordigital.com/blog"
  schema={{
    "@context": "https://schema.org",
    "@type": "Blog",
    "name": "Blog ProtetorDigital",
    "url": "https://protetordigital.com/blog",
    "description": "Artigos sobre segurança digital, privacidade e proteção de dados para brasileiros",
    "inLanguage": "pt-BR",
    "publisher": { "@type": "Organization", "name": "ProtetorDigital", "url": "https://protetordigital.com" }
  }}
>

  <div class="container" style="padding-top:40px;padding-bottom:80px;">

    <!-- Breadcrumb -->
    <nav aria-label="Localização na página" style="margin-bottom:32px;">
      <ol class="breadcrumb">
        <li><a href="/">início</a></li>
        <li class="breadcrumb-sep" aria-hidden="true">/</li>
        <li style="color:var(--text-2);">blog</li>
      </ol>
    </nav>

    <!-- Header -->
    <header style="margin-bottom:48px;">
      <span class="badge badge-cyan" style="display:inline-block;margin-bottom:14px;">Publicações</span>
      <h1 style="font-family:var(--font-body);font-size:clamp(2rem,5vw,2.6rem);font-weight:800;color:var(--text);letter-spacing:-0.05em;margin-bottom:12px;">Blog de Segurança</h1>
      <p style="font-size:15px;color:var(--text-2);max-width:480px;line-height:1.7;">Artigos práticos sobre como proteger sua vida digital. Sem jargão, direto ao ponto.</p>
    </header>

    <!-- Main layout -->
    <div style="display:grid;grid-template-columns:1fr;gap:24px;" id="blog-layout">

      <!-- Posts column -->
      <div>

        <!-- Featured post -->
        {featured && (
          <a href={`/blog/${featured.slug}`} class="card card-hover" style="text-decoration:none;display:block;padding:32px;margin-bottom:16px;position:relative;overflow:hidden;" aria-label={`Artigo em destaque: ${featured.data.title}`}>
            <div aria-hidden="true" style="position:absolute;top:0;right:0;width:200px;height:200px;background:radial-gradient(ellipse,rgba(59,130,246,0.06) 0%,transparent 70%);pointer-events:none;"></div>
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:18px;">
              <span class="badge badge-blue">Destaque</span>
              {featured.data.tags.slice(0,2).map(tag => <span class="badge badge-cyan">#{tag}</span>)}
            </div>
            <h2 style="font-family:var(--font-body);font-size:clamp(1.2rem,2.5vw,1.5rem);font-weight:800;color:var(--text);margin-bottom:10px;letter-spacing:-0.03em;line-height:1.3;">{featured.data.title}</h2>
            <p style="font-size:14px;color:var(--text-2);line-height:1.7;margin-bottom:20px;max-width:560px;">{featured.data.description}</p>
            <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;">
              <div style="display:flex;align-items:center;gap:10px;">
                <span style="font-size:12px;color:var(--text-3);">{featured.data.author}</span>
                <span style="color:var(--border-2);" aria-hidden="true">·</span>
                <time class="mono" style="font-size:12px;color:var(--text-3);" datetime={featured.data.pubDate.toISOString()}>
                  {featured.data.pubDate.toLocaleDateString('pt-BR', { day:'2-digit', month:'long', year:'numeric' })}
                </time>
              </div>
              <span style="font-family:var(--font-mono);font-size:12px;color:var(--blue);display:flex;align-items:center;gap:5px;">Ler artigo <span aria-hidden="true">→</span></span>
            </div>
          </a>
        )}

        <!-- Post list -->
        <div style="display:flex;flex-direction:column;gap:12px;">
          {rest.map((post, i) => (
            <>
              <a href={`/blog/${post.slug}`} class="card card-hover" style="text-decoration:none;display:block;padding:22px 24px;" aria-label={post.data.title}>
                <div style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px;">
                  {post.data.tags.slice(0,2).map(tag => <span class="badge badge-cyan">#{tag}</span>)}
                </div>
                <h2 style="font-family:var(--font-body);font-size:1rem;font-weight:700;color:var(--text);margin-bottom:6px;letter-spacing:-0.02em;line-height:1.4;">{post.data.title}</h2>
                <p style="font-size:13px;color:var(--text-2);line-height:1.65;margin-bottom:14px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;">{post.data.description}</p>
                <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;">
                  <span style="font-size:11px;color:var(--text-3);">{post.data.author}</span>
                  <time class="mono" style="font-size:11px;color:var(--text-3);" datetime={post.data.pubDate.toISOString()}>
                    {post.data.pubDate.toLocaleDateString('pt-BR', { day:'2-digit', month:'long', year:'numeric' })}
                  </time>
                </div>
              </a>

              {/* AdSense between posts */}
              {i === 1 && ADSENSE_ID && (
                <div style="display:flex;justify-content:center;padding:4px 0;">
                  <ins class="adsbygoogle" style="display:block" data-ad-client={ADSENSE_ID} data-ad-slot="BLOG_LIST_BETWEEN_SLOT" data-ad-format="auto" data-full-width-responsive="true"></ins>
                  <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
                </div>
              )}
            </>
          ))}
        </div>

        {posts.length === 0 && (
          <div class="card" style="padding:56px 24px;text-align:center;">
            <div style="width:48px;height:48px;background:var(--surface-2);border:1px solid var(--border-2);border-radius:var(--radius-md);display:flex;align-items:center;justify-content:center;margin:0 auto 18px;" aria-hidden="true">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--text-3)" stroke-width="1.8" stroke-linecap="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
            </div>
            <p style="font-family:var(--font-body);font-size:1rem;font-weight:700;color:var(--text);margin-bottom:8px;">Em breve</p>
            <p style="font-size:14px;color:var(--text-2);">Estamos preparando artigos sobre segurança digital.</p>
          </div>
        )}
      </div>

      <!-- Sidebar -->
      <aside id="blog-sidebar" style="display:flex;flex-direction:column;gap:16px;">

        <!-- AdSense Sidebar -->
        {ADSENSE_ID && (
          <ins class="adsbygoogle" style="display:block;width:300px;height:600px;max-width:100%;" data-ad-client={ADSENSE_ID} data-ad-slot="BLOG_SIDEBAR_SLOT"></ins>
        )}
        {ADSENSE_ID && <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>}

        <!-- RSS -->
        <div class="card" style="padding:22px;">
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--blue)" stroke-width="2" stroke-linecap="round" aria-hidden="true"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg>
            <h2 style="font-family:var(--font-body);font-size:13px;font-weight:700;color:var(--text);">RSS Feed</h2>
          </div>
          <p style="font-size:13px;color:var(--text-2);margin-bottom:14px;line-height:1.6;">Receba novos artigos no seu leitor favorito.</p>
          <a href="/rss.xml" class="btn btn-outline btn-sm btn-full" style="justify-content:center;">Assinar RSS</a>
        </div>

        <!-- Tags -->
        {allTags.length > 0 && (
          <div class="card" style="padding:22px;">
            <h2 style="font-family:var(--font-body);font-size:13px;font-weight:700;color:var(--text);margin-bottom:14px;">Tópicos</h2>
            <div style="display:flex;flex-wrap:wrap;gap:6px;">
              {allTags.map(tag => <span class="badge">#{tag}</span>)}
            </div>
          </div>
        )}

        <!-- CTA -->
        <div class="card" style="padding:22px;background:rgba(59,130,246,0.03);border-color:rgba(59,130,246,0.18);">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--blue)" stroke-width="2" stroke-linecap="round" aria-hidden="true"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            <h2 style="font-family:var(--font-body);font-size:13px;font-weight:700;color:var(--text);">Proteja-se agora</h2>
          </div>
          <p style="font-size:13px;color:var(--text-2);margin-bottom:16px;line-height:1.6;">Use nossas ferramentas gratuitas para verificar sua segurança agora mesmo.</p>
          <div style="display:flex;flex-direction:column;gap:8px;">
            <a href="/tools/senha" class="btn btn-primary btn-sm">Verificar minha senha</a>
            <a href="/tools/vazamento" class="btn btn-outline btn-sm" style="justify-content:center;">Verificar vazamentos</a>
          </div>
        </div>

      </aside>
    </div>
  </div>

  <style>
    @media (min-width: 1024px) {
      #blog-layout { grid-template-columns: 1fr 300px !important; }
    }
  </style>

</Layout>
