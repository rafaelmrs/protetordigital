---
import { ViewTransitions } from 'astro:transitions';
interface Props {
  title: string;
  description: string;
  image?: string;
  url?: string;
  type?: string;
  schema?: object;
}
const {
  title,
  description,
  image = '/og-default.png',
  url = Astro.url.href,
  type = 'website',
  schema,
} = Astro.props;

const GA_ID = import.meta.env.PUBLIC_GA_ID;
const ADSENSE_ID = import.meta.env.PUBLIC_ADSENSE_ID;
const SITE = 'https://protetordigital.com';
---
<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0a0f1e" media="(prefers-color-scheme: dark)" />
  <meta name="theme-color" content="#f5f7fb" media="(prefers-color-scheme: light)" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="manifest" href="/manifest.json" />
  <link rel="canonical" href={url} />
  <link rel="sitemap" href="/sitemap.xml" />
  <link rel="alternate" type="application/rss+xml" title="Protetor Digital — Blog de Segurança" href="/rss.xml" />

  <!-- Primary Meta -->
  <title>{title} | ProtetorDigital</title>
  <meta name="description" content={description} />
  <meta name="keywords" content="proteção digital, segurança online, verificar senha, vazamento de dados, link malicioso, privacidade, LGPD, brasil" />
  <meta name="robots" content="index, follow" />
  <meta name="author" content="ProtetorDigital" />

  <!-- Open Graph -->
  <meta property="og:type" content={type} />
  <meta property="og:url" content={url} />
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:image" content={`${SITE}${image}`} />
  <meta property="og:locale" content="pt_BR" />
  <meta property="og:site_name" content="ProtetorDigital" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={`${SITE}${image}`} />

  <!-- Schema.org base -->
  <script type="application/ld+json">{JSON.stringify({
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "ProtetorDigital",
    "url": SITE,
    "description": "Ferramentas gratuitas de proteção digital para brasileiros",
    "inLanguage": "pt-BR",
    "potentialAction": { "@type": "SearchAction", "target": `${SITE}/blog?q={search_term_string}`, "query-input": "required name=search_term_string" }
  })}</script>
  {schema && <script type="application/ld+json" set:html={JSON.stringify(schema)} />}

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet" />

  <!-- AdSense -->
  {ADSENSE_ID && (
    <script async src={`https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=${ADSENSE_ID}`} crossorigin="anonymous"></script>
  )}

  <!-- Google Analytics -->
  {GA_ID && (
    <>
      <script async src={`https://www.googletagmanager.com/gtag/js?id=${GA_ID}`}></script>
      <script define:vars={{ GA_ID }}>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', GA_ID, { anonymize_ip: true });
      </script>
    </>
  )}

  <!-- Inline theme init (prevents FOUC) — dark é o padrão -->
  <script is:inline>
    (function() {
      var stored = localStorage.getItem('pd-theme');
      // Se não há preferência salva, usa dark por padrão
      var t = stored || 'dark';
      document.documentElement.className = t;
    })();
  </script>

  <link rel="stylesheet" href="/global.css" />

  <ViewTransitions />
</head>
<body>

  <!-- AdSense Desktop Header Banner -->
  {ADSENSE_ID && (
    <div id="adsense-header" style="display:none;justify-content:center;padding:8px 0;background:var(--bg-2);border-bottom:1px solid var(--border);">
      <ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client={ADSENSE_ID} data-ad-slot="HEADER_LEADERBOARD_SLOT"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>
  )}

  <!-- NAVIGATION -->
  <header id="site-nav" style="position:sticky;top:0;z-index:100;backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);background:var(--nav-bg);border-bottom:1px solid var(--border);">
    <div class="container" style="display:flex;align-items:center;justify-content:space-between;height:60px;">

      <!-- Logo -->
      <a href="/" style="display:flex;align-items:center;gap:10px;text-decoration:none;flex-shrink:0;" aria-label="ProtetorDigital — Início">
        <div style="width:32px;height:32px;flex-shrink:0;">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" aria-hidden="true">
            <path fill="#3b82f6" d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12c5.16-1.26 9-6.45 9-12V5l-9-4z"/>
            <circle fill="white" cx="12" cy="9" r="3"/>
            <path fill="white" d="M6.87 17c-.34-.5-.63-1-.87-1.53c0-1.65 2.71-3 6-3s6 1.32 6 3c-.24.53-.53 1.03-.87 1.53A9.69 9.69 0 0 1 12 20.92A9.69 9.69 0 0 1 6.87 17z"/>
          </svg>
        </div>
        <span style="font-family:var(--font-body);font-weight:700;font-size:16px;color:var(--text);letter-spacing:-0.03em;">Protetor Digital</span>
      </a>

      <!-- Desktop Nav -->
      <nav id="desktop-nav" style="display:none;align-items:center;gap:2px;" aria-label="Navegação principal">
        <a href="/tools/senha" class="nav-link">Senhas</a>
        <a href="/tools/link" class="nav-link">Links</a>
        <a href="/tools/vazamento" class="nav-link">Vazamentos</a>
        <a href="/blog" class="nav-link">Blog</a>
        <a href="/sobre" class="nav-link">Sobre</a>
        <a href="/contato" class="nav-link">Contato</a>
      </nav>

      <!-- Actions -->
      <div style="display:flex;align-items:center;gap:8px;">
        <button id="theme-toggle" aria-label="Alternar tema claro/escuro" style="width:38px;height:38px;border-radius:var(--radius-sm);border:1px solid var(--border-2);background:var(--surface);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all var(--transition);color:var(--text-2);">
          <svg id="icon-moon" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
          <svg id="icon-sun" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" style="display:none;"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
        </button>
        <button id="menu-toggle" aria-label="Abrir menu" aria-expanded="false" style="width:38px;height:38px;border-radius:var(--radius-sm);border:1px solid var(--border-2);background:var(--surface);cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--text-2);">
          <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true">
            <line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Nav -->
    <nav id="mobile-nav" aria-label="Menu mobile" style="background:var(--surface);border-top:1px solid var(--border);">
      <div style="padding:8px 12px 12px;display:flex;flex-direction:column;gap:2px;">
        <a href="/tools/senha" class="nav-link" style="padding:12px 16px;">Analisador de Senhas</a>
        <a href="/tools/link" class="nav-link" style="padding:12px 16px;">Verificador de Links</a>
        <a href="/tools/vazamento" class="nav-link" style="padding:12px 16px;">Verificador de Vazamentos</a>
        <a href="/blog" class="nav-link" style="padding:12px 16px;">Blog de Segurança</a>
        <a href="/sobre" class="nav-link" style="padding:12px 16px;">Sobre</a>
        <a href="/contato" class="nav-link" style="padding:12px 16px;">Contato</a>
      </div>
    </nav>
  </header>

  <main>
    <slot />
  </main>

  <!-- FOOTER -->
  <footer style="background:var(--bg-2);border-top:1px solid var(--border);padding:56px 0 32px;">
    <!-- Mobile AdSense Footer -->
    {ADSENSE_ID && (
      <div id="adsense-footer-mobile" style="display:flex;justify-content:center;padding:8px 0;margin-bottom:32px;border-bottom:1px solid var(--border);">
        <ins class="adsbygoogle" style="display:inline-block;width:320px;height:50px" data-ad-client={ADSENSE_ID} data-ad-slot="FOOTER_MOBILE_SLOT"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
      </div>
    )}
    <div class="container">
      <div style="display:grid;grid-template-columns:1fr;gap:44px;" id="footer-grid">
        <!-- Brand -->
        <div>
          <a href="/" style="display:inline-flex;align-items:center;gap:9px;text-decoration:none;margin-bottom:14px;">
            <div style="width:28px;height:28px;background:var(--blue);border-radius:7px;display:flex;align-items:center;justify-content:center;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" aria-hidden="true"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            </div>
            <span style="font-family:var(--font-body);font-weight:700;font-size:15px;color:var(--text);letter-spacing:-0.02em;">Protetor Digital</span>
          </a>
          <p style="font-size:13px;color:var(--text-2);line-height:1.7;max-width:280px;margin-bottom:18px;">Ferramentas gratuitas para proteger sua vida digital. Seus dados nunca saem do seu dispositivo.</p>
          <div style="display:flex;gap:6px;flex-wrap:wrap;">
            <span class="badge badge-blue">LGPD</span>
            <span class="badge badge-emerald">100% Grátis</span>
            <span class="badge" style="display:inline-flex;align-items:center;gap:5px;">
                <svg width="16" height="12" viewBox="0 0 32 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" style="flex-shrink:0;border-radius:2px;">
                  <rect width="32" height="24" fill="#009C3B"/>
                  <polygon points="16,3 29,12 16,21 3,12" fill="#FEDF00"/>
                  <circle cx="16" cy="12" r="5.5" fill="#002776"/>
                  <path d="M10.8,10.5 Q16,8.5 21.2,10.5" stroke="white" stroke-width="0.9" fill="none"/>
                </svg>
                Brasil
              </span>
          </div>
        </div>

        <!-- Links -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:32px;">
          <div>
            <p style="font-family:var(--font-body);font-weight:700;font-size:11px;color:var(--text-3);margin-bottom:16px;text-transform:uppercase;letter-spacing:0.1em;">Ferramentas</p>
            <nav style="display:flex;flex-direction:column;gap:12px;" aria-label="Links de ferramentas">
              <a href="/tools/senha" style="font-size:13px;color:var(--text-2);text-decoration:none;transition:color var(--transition);" onmouseover="this.style.color='var(--blue)'" onmouseout="this.style.color='var(--text-2)'">Analisador de Senhas</a>
              <a href="/tools/link" style="font-size:13px;color:var(--text-2);text-decoration:none;transition:color var(--transition);" onmouseover="this.style.color='var(--blue)'" onmouseout="this.style.color='var(--text-2)'">Verificador de Links</a>
              <a href="/tools/vazamento" style="font-size:13px;color:var(--text-2);text-decoration:none;transition:color var(--transition);" onmouseover="this.style.color='var(--blue)'" onmouseout="this.style.color='var(--text-2)'">Verificador de Vazamentos</a>
            </nav>
          </div>
          <div>
            <p style="font-family:var(--font-body);font-weight:700;font-size:11px;color:var(--text-3);margin-bottom:16px;text-transform:uppercase;letter-spacing:0.1em;">Informações</p>
            <nav style="display:flex;flex-direction:column;gap:12px;" aria-label="Links informativos">
              <a href="/blog" style="font-size:13px;color:var(--text-2);text-decoration:none;transition:color var(--transition);" onmouseover="this.style.color='var(--blue)'" onmouseout="this.style.color='var(--text-2)'">Blog de Segurança</a>
              <a href="/sobre" style="font-size:13px;color:var(--text-2);text-decoration:none;transition:color var(--transition);" onmouseover="this.style.color='var(--blue)'" onmouseout="this.style.color='var(--text-2)'">Sobre</a>
              <a href="/contato" style="font-size:13px;color:var(--text-2);text-decoration:none;transition:color var(--transition);" onmouseover="this.style.color='var(--blue)'" onmouseout="this.style.color='var(--text-2)'">Contato</a>
              <a href="/politica-privacidade" style="font-size:13px;color:var(--text-2);text-decoration:none;transition:color var(--transition);" onmouseover="this.style.color='var(--blue)'" onmouseout="this.style.color='var(--text-2)'">Política de Privacidade</a>
            </nav>
          </div>
        </div>
      </div>

      <div class="divider" style="margin:40px 0 24px;"></div>

      <div style="display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:12px;">
        <p style="font-size:12px;color:var(--text-3);font-family:var(--font-mono);">© {new Date().getFullYear()} ProtetorDigital</p>
        <p style="font-size:12px;color:var(--text-3);">Em conformidade com a <a href="https://www.gov.br/anpd" target="_blank" rel="noopener" style="color:var(--blue);text-decoration:none;">LGPD</a></p>
      </div>
    </div>
  </footer>

  <!-- Responsive overrides -->
  <style>
    
    @media (min-width: 768px) {
      #desktop-nav { display: flex !important; }
      #menu-toggle { display: none !important; }
      #adsense-header { display: flex !important; }
      #adsense-footer-mobile { display: none !important; }
      #footer-grid { grid-template-columns: 1.2fr 1fr !important; }
    }
  </style>

  <script is:inline>
    // Executa na carga inicial e após cada navegação do ViewTransitions
    function initUI() {
      // Theme toggle
      const themeBtn = document.getElementById('theme-toggle');
      const iconMoon = document.getElementById('icon-moon');
      const iconSun = document.getElementById('icon-sun');

      function setTheme(theme) {
        document.documentElement.className = theme;
        localStorage.setItem('pd-theme', theme);
        if (iconMoon) iconMoon.style.display = theme === 'dark' ? 'block' : 'none';
        if (iconSun) iconSun.style.display = theme === 'light' ? 'block' : 'none';
      }

      const current = document.documentElement.className.includes('light') ? 'light' : 'dark';
      if (iconMoon) iconMoon.style.display = current === 'dark' ? 'block' : 'none';
      if (iconSun) iconSun.style.display = current === 'light' ? 'block' : 'none';

      // Remover listener anterior para evitar duplicação
      if (themeBtn && !themeBtn._pdListener) {
        themeBtn._pdListener = true;
        themeBtn.addEventListener('click', () => {
          setTheme(document.documentElement.className.includes('light') ? 'dark' : 'light');
        });
      }

      // Mobile menu
      const menuBtn = document.getElementById('menu-toggle');
      const mobileNav = document.getElementById('mobile-nav');
      if (menuBtn && !menuBtn._pdListener) {
        menuBtn._pdListener = true;
        menuBtn.addEventListener('click', () => {
          const isOpen = mobileNav?.classList.toggle('open');
          menuBtn.setAttribute('aria-expanded', String(isOpen));
        });
      }

      // Active nav
      const path = window.location.pathname;
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
        const href = link.getAttribute('href');
        if (href === path || (path.startsWith('/blog') && href === '/blog') || (path.startsWith('/tools') && href?.startsWith('/tools') && path.startsWith(href))) {
          link.classList.add('active');
        }
      });
    }

    // Executa na carga inicial
    initUI();
    // Executa após cada navegação do View Transitions
    document.addEventListener('astro:page-load', initUI);
  </script>
</body>
</html>
